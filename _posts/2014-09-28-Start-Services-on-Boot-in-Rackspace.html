---           
layout: post
title: Start Services on Boot in Rackspace
date: 2014-09-28 09:18:02 UTC
updated: 2014-09-28 09:18:02 UTC
comments: false
categories: 
---

 <script language="javascript" src="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js" type="text/javascript"></script><script language="javascript" src="http://google-code-prettify.googlecode.com/svn/trunk/src/lang-css.js" type="text/javascript"></script><script type="text/javascript">function addLoadEvent(func) {   var oldonload = window.onload;   if (typeof window.onload != 'function') {     window.onload = func;   } else {     window.onload = function() {       if (oldonload) {         oldonload();       }       func();     }   } } addLoadEvent(function() {     prettyPrint(); }); </script> <style type="text/css">/* Pretty printing styles. Used with prettify.js. */  .str { color: #080; } .kwd { color: #008; } .com { color: #800; } .typ { color: #606; } .lit { color: #066; } .pun { color: #660; } .pln { color: #000; } .tag { color: #008; } .atn { color: #606; } .atv { color: #080; } .dec { color: #606; } pre.prettyprint { padding: 2px; border: 1px solid #888; }  @media print {   .str { color: #060; }   .kwd { color: #006; font-weight: bold; }   .com { color: #600; font-style: italic; }   .typ { color: #404; font-weight: bold; }   .lit { color: #044; }   .pun { color: #440; }   .pln { color: #000; }   .tag { color: #006; font-weight: bold; }   .atn { color: #404; }   .atv { color: #060; } } </style>  <div dir="ltr" style="text-align: left;" trbidi="on">Rackspace provides Redhat servers. Suppose we are deploying a web application on a server. The web application uses many services  - http service, search service(elasticsearch), caching service, database service(mysql, mongodb), etc .<br /><br />There may be cases where would need to reboot the server. In such scenarios, the above listed services, when the server reboots, might not start. This is where the utility named <code>chkconfig</code> helps.<br /> <pre class="prettyprint">chkconfig --list</pre> The above command lists the services which can be configured to start on boot-up. The first column lists the name of the service while the rest of the columns tell at which runlevel the service is started. <br/><br/> Runlevels control which services are automatically started by the system when the system starts in that runlevel. <a href="https://wiki.debian.org/RunLevel">Here</a> is the link that explains run level more explicitly. On a sidenote, to make the concept of a runlevel more clear, we can specify runlevel at the time of boot in the grub file. Runlevels are really helpful, when we want to enter the terminal and edit the messed up startup scripts which prevent normal system boot. <a href=>This</a> link will be helpful to understand my point. <br/>  Coming back to <code>chkconfig</code>, it is really easy to include services in <code>chkconfig</code> and specify the runlevels at which they will be started. <br/> <pre class="prettyprint">chkconfig --add SERVICENANE</pre> Using the above command, we can add the service in the runlevels specified in the init script of that service. For example, the is the init-script of elasticsearch: <pre class="prettyprint"><br />## /etc/init.d/elasticsearch<br /><br /><br />#<br /># elasticsearch <summary><br />#<br /># chkconfig:   2345 80 20<br /># description: Starts and stops a single elasticsearch <br />#              instance on this system <br />#<br /><br />### BEGIN INIT INFO<br /># Provides: Elasticsearch<br /># Required-Start: $network $named<br /># Required-Stop: $network $named<br /># Default-Start: 2 3 4 5<br /># Default-Stop: 0 1 6<br /># Short-Description: This service manages the elasticsearch daemon<br /># Description: Elasticsearch is a very scalable, schema-free and <br />#              high-performance search solution supporting multi-tenancy <br />#              and near realtime search.<br />### END INIT INFO<br /><br /></pre> The might be cases where the service is not recognized by the chkconfig even though it is located in <code>/etc/init.d</code>. This is because the above lines (see the above code) are not added in the script. Though these lines are commented, they are used by the <code>chkconfig</code> to recognize it as a service that can be added at boot. For example, I used Nginx to serve http requests. The nginx init script (/etc/init.d/nginx) did not have the above code block. This is what I added at the beginning of the file after <code>#!/bin/bash</code> to make it <code>chkconfig</code> friendly.  <pre class="prettyprint"><br /># <br /># nginx         Service that starts and stops the http server<br /># chkconfig: 2345 95 05<br /># description: HTTP server<br /># processname: nginx<br /># config: /etc/nginx/conf/nginx.conf<br /># pid: /opt/nginx/logs/nginx.pid<br />### BEGIN INIT INFO<br /># Provides: nginx<br /># Required-Start: $local_fs $remote_fs<br /># Required-Stop: $local_fs $remote_fs<br /># Short-Description: start and stop nginx server<br /># Description: HTTP Server<br />## END INIT INFO<br /><br /></pre><br/> Now, if I want to add a particular service to say, runlevel 2,3,4,5 - then, this is the command that I will execute: <pre class="prettyprint"><br />chkconfig --level 2345 SERVICENAME on<br /></pre> You can figure out more use cases for <code>chkconfig</code> by viewing its manual. </div>